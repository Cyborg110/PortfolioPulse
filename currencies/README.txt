Модуль currencies — всё, что связано с валютами в проекте.
Состоит из двух логических частей:

1. Работа с валютами как с обычными торговыми инструментами (покупка/продажа, анализ)
2. Конвертация любых денежных сумм / свечей / выплат между валютами

Структура модуля
├── __init__.py         → re-export Currency, Currencies, converter
├── models.py           → классы Currency и Currencies (аналоги Stock/Bond)
├── converter.py        → конвертер валют (синглтон converter)
├── database.py         → таблица currencies (список всех валютных пар)
└── README.txt          ← ты читаешь его сейчас

================================================================================
Часть 1. Валюты как активы (models.py)
================================================================================

Классы:
• Currency  → наследует BaseAsset (точно как Stock, Bond, Etf)
• Currencies → контейнер для массовой работы (как Stocks, Bonds)

Currency — это обычный торговый инструмент.
Можно:
    currency = Currency("USDRUB_TOM")
    await currency.candles.update_candles()
    currency.candles.calculate_static()
    print(currency.candles.volatility)

Полный набор метрик свечей доступен:
    volatility, sharpe_ratio, max_drawdown, atr_14 и т.д.

В будущем сюда можно будет добавить:
    • расчёт carry trade
    • прогнозы по процентным ставкам
    • сигналы на покупку/продажу валютных пар

Currencies — массовый загрузчик:
    currencies = Currencies(filters={"buy_available_flag": True})
    await currencies.update_candles(sleep=0.05)

================================================================================
Часть 2. Конвертер валют (converter.py)
================================================================================

Глобальный объект:
    from currencies.converter import converter

Поддерживаемые валюты (ноябрь 2025):
    eur, usd, cny, try, hkd, sek, kzt, uzs, byn, amd, kgs, tjs

Все остальные (gbp, jpy, chf, aud, rub → rub и т.д.) — НЕ поддерживаются.

Ключевой принцип конвертера:
    «Если не можем конвертировать — возвращаем объект как есть. Никогда не падаем.»

Что происходит при неподдерживаемой валюте:

┌─────────────────────────────┬─────────────────────────────────────────────────────┐
│ Сценарий                    │ Результат                                           │
├─────────────────────────────┼─────────────────────────────────────────────────────┤
│ converter.gbp.value_to(1000)│ → 1000 (исходное значение)                          │
│ candles_to / candles_from   │ → объект Candles НЕ меняется, цены остаются прежними│
│ payments_to / payments_from │ → amount у всех выплат остаются прежними            │
│ converter.convert(obj, "jpy", "rub") │ → объект возвращается без изменений       │
└─────────────────────────────┴─────────────────────────────────────────────────────┘

Когда валюта поддерживается — конвертация точная:
• Курс берётся из свечей валютной пары (BBG0013HGFT4 для USD/RUB и т.д.)
• Поиск курса: точная дата → предыдущая свеча → первая свеча
• После конвертации candles.currency меняется, цены пересчитываются

Главные методы конвертера:

converter.usd.value_to(1000, date)        → 1000 USD в RUB на дату
converter["cny"].value_from(5000)         → 5000 RUB → CNY
converter.convert(obj, from_iso, to_iso)  → универсальный метод (candles или payments)

Обновление курсов:
    await converter.update_candles(sleep=0.05)
    → обновляет ВСЕ поддерживаемые валюты сразу
    → делается один раз при старте приложения

================================================================================
Как правильно использовать весь модуль currencies
================================================================================

1. Если нужно анализировать валюту как актив (волатильность, шерп и т.д.):
       currency = Currency("USDRUB_TOM")
       await currency.candles.update_candles()
       currency.candles.calculate_static()
       print(f"Volatility USD/RUB: {currency.candles.volatility:.2%}")

2. Если нужно конвертировать облигацию/акцию/выплаты в рубли:
       converter.convert(bond.candles[CandleInterval.CANDLE_INTERVAL_DAY], bond.currency, "rub")
       converter.convert(bond.payments, bond.currency, "rub")
       # → если валюта не поддерживается — ничего не сломается

3. Если нужно просто перевести сумму:
       rub_amount = converter.usd.value_to(1000)  # 1000 USD → RUB

================================================================================
Итог
================================================================================

Модуль currencies — это два в одном:

• Currency / Currencies — полноценные торговые активы (как акции и облигации)
• converter — абсолютно безопасный конвертер валют (не падает никогда)

Благодаря строгому разделению:
• Анализ валютных пар работает независимо от конвертера
• Конвертер можно использовать везде без страха упасть на "экзотической" валюте

Оба компонента уже активно используются в Bond.calculate_metrics() и в будущем будут использоваться в прогнозах по carry trade.